const glmatrix=document.createElement("script");glmatrix.src="https://cdn.jsdelivr.net/npm/gl-matrix@2.8.1/dist/gl-matrix-min.js",document.head.appendChild(glmatrix),glmatrix.addEventListener("load",()=>{Objects=[],renderObjects=[],cam_debug=!0;let e=!1,t=[...document.querySelectorAll(".overlayText")];function r(){let e={pos:[0,0,0],rot:[0,0,0],vertices:[],id:""};return Objects.push(e),e}function o(e){}function n(e=[1,0,0,1],t=1){return[-(t/=2),-t,-t,...e,-t,t,-t,...e,t,-t,-t,...e,t,t,-t,...e,-t,t,-t,...e,t,-t,-t,...e,-t,-t,t,...e,-t,t,t,...e,t,-t,t,...e,t,t,t,...e,-t,t,t,...e,t,-t,t,...e,-t,-t,-t,...e,t,-t,-t,...e,-t,-t,t,...e,t,-t,t,...e,t,-t,-t,...e,-t,-t,t,...e,-t,t,-t,...e,t,t,-t,...e,-t,t,t,...e,t,t,t,...e,t,t,-t,...e,-t,t,t,...e,-t,-t,-t,...e,-t,-t,t,...e,-t,t,-t,...e,-t,t,t,...e,-t,-t,t,...e,-t,t,-t,...e,t,-t,-t,...e,t,-t,t,...e,t,t,-t,...e,t,t,t,...e,t,-t,t,...e,t,t,-t,...e,]}function i(e=[[1,0,0,1],[0,1,0,1],[0,0,1,1],[1,1,0,1],[1,0,1,1],[0,1,1,1]],t=1){return[-(t/=2),-t,-t,...e[0],-t,t,-t,...e[0],t,-t,-t,...e[0],t,t,-t,...e[0],-t,t,-t,...e[0],t,-t,-t,...e[0],-t,-t,t,...e[1],-t,t,t,...e[1],t,-t,t,...e[1],t,t,t,...e[1],-t,t,t,...e[1],t,-t,t,...e[1],-t,-t,-t,...e[2],t,-t,-t,...e[2],-t,-t,t,...e[2],t,-t,t,...e[2],t,-t,-t,...e[2],-t,-t,t,...e[2],-t,t,-t,...e[3],t,t,-t,...e[3],-t,t,t,...e[3],t,t,t,...e[3],t,t,-t,...e[3],-t,t,t,...e[3],-t,-t,-t,...e[4],-t,-t,t,...e[4],-t,t,-t,...e[4],-t,t,t,...e[4],-t,-t,t,...e[4],-t,t,-t,...e[4],t,-t,-t,...e[5],t,-t,t,...e[5],t,t,-t,...e[5],t,t,t,...e[5],t,-t,t,...e[5],t,t,-t,...e[5],]}function $(){let e=document.createElement("div");return e.style.top="100px",e.style.left="100px",e.classList.add("overlayText"),document.body.appendChild(e),e}let a=[];function _(e,t,r){let o=r*(Math.PI/180),n=Math.cos(o),i=Math.sin(o),$=e[0]*t[0]+e[1]*t[1]+e[2]*t[2];return u([e[0]*n+(t[1]*e[2]-t[2]*e[1])*i+t[0]*$*(1-n),e[1]*n+(t[2]*e[0]-t[0]*e[2])*i+t[1]*$*(1-n),e[2]*n+(t[0]*e[1]-t[1]*e[0])*i+t[2]*$*(1-n)])}function l(e,t){return 0!=t[0]&&(e=_(e,[1,0,0],t[0])),0!=t[1]&&(e=_(e,[0,1,0],t[1])),0!=t[2]&&(e=_(e,[0,0,1],t[2])),e}(map_vertices=r()).id="map vertices",map_vertices.pos[1]=-1,map_vertices.vertices=[10,0,10,.34,.34,.34,1,-10,0,10,.34,.34,.34,1,-10,0,-10,.34,.34,.34,1,10,0,10,.34,.34,.34,1,10,0,-10,.34,.34,.34,1,-10,0,-10,.34,.34,.34,1];let d=document.getElementById("3d"),c=d.getContext("webgl");function s(e){e.length%21==0&&a.push(...e)}function m(){for(let e=0;e<Objects.length;e++)for(let t=0;t<Objects[e].vertices.length/21;t++){let r=[];for(let o=0;o<21;o++)r[o]=Objects[e].vertices[21*t+o];for(let n=0;n<3;n++)rotatedVertex=l([r[0+7*n],r[1+7*n],r[2+7*n]],Objects[e].rot),r[0+7*n]=rotatedVertex[0],r[1+7*n]=rotatedVertex[1],r[2+7*n]=rotatedVertex[2];r[0]+=Objects[e].pos[0],r[1]+=Objects[e].pos[1],r[2]+=Objects[e].pos[2],r[7]+=Objects[e].pos[0],r[8]+=Objects[e].pos[1],r[9]+=Objects[e].pos[2],r[14]+=Objects[e].pos[0],r[15]+=Objects[e].pos[1],r[16]+=Objects[e].pos[2],renderObjects.push(...r)}}function u(e,t=10){return e.map(e=>1e-10>Math.abs(e)?0:parseFloat(e.toFixed(t)))}function g(){if(e){P(),v(),E(d,c),cam_debug?(document.getElementById("cameraPosition").style.display="",document.getElementById("cameraYaw").style.display="",document.getElementById("cameraPitch").style.display=""):(document.getElementById("cameraPosition").style.left="-100px",document.getElementById("cameraYaw").style.display="none",document.getElementById("cameraPitch").style.display="none");try{onframe()}catch(t){console.log(t)}renderObjects=[],m();N([...a,...renderObjects])}requestAnimationFrame(()=>g())}function E(e,t){e.width=window.innerWidth,e.height=window.innerHeight,t.viewport(0,0,e.width,e.height)}let p=[0,0,5],A=[0,0,-1],f=[0,1,0],y=-90,h=0,x={};function P(){let e=vec3.cross([],A,f);x.w&&vec3.scaleAndAdd(p,p,A,.1),x.s&&vec3.scaleAndAdd(p,p,A,-.1),x.a&&vec3.scaleAndAdd(p,p,e,-.1),x.d&&vec3.scaleAndAdd(p,p,e,.1),x.e&&(p[1]+=.1),x.q&&(p[1]-=.1),x.ArrowLeft&&(y-=1),x.ArrowRight&&(y+=1),x.ArrowUp&&(h+=1),x.ArrowDown&&(h-=1),h=Math.max(-89,Math.min(89,h)),A[0]=Math.cos(glMatrix.toRadian(y))*Math.cos(glMatrix.toRadian(h)),A[1]=Math.sin(glMatrix.toRadian(h)),A[2]=Math.sin(glMatrix.toRadian(y))*Math.cos(glMatrix.toRadian(h)),vec3.normalize(A,A)}function v(){let e=[p[0]+A[0],p[1]+A[1],p[2]+A[2]];mat4.lookAt(F,p,e,f)}function R(e,t){let r;t===e.VERTEX_SHADER?r="attribute vec3 aPosition;attribute vec4 aColor;varying vec4 vColor;uniform mat4 uModelViewMatrix;uniform mat4 uProjectionMatrix;void main(){gl_Position=uProjectionMatrix*uModelViewMatrix*vec4(aPosition,1.0);vColor=aColor;}":t===e.FRAGMENT_SHADER&&(r="precision mediump float;varying vec4 vColor;void main(){gl_FragColor=vColor;}");let o=e.createShader(t);return(e.shaderSource(o,r),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS))?o:(console.error("Error compiling shader:",e.getShaderInfoLog(o)),e.deleteShader(o),null)}function T(e,t,r){let o=e.createProgram();return(e.attachShader(o,t),e.attachShader(o,r),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS))?o:(console.error("Error linking program:",e.getProgramInfoLog(o)),e.deleteProgram(o),null)}document.addEventListener("keydown",e=>{x[e.key]=!0}),document.addEventListener("keyup",e=>{delete x[e.key]});let S=R(c,c.VERTEX_SHADER),L=R(c,c.FRAGMENT_SHADER),B=T(c,S,L),w=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,w);let I=c.getAttribLocation(B,"aPosition"),b=c.getAttribLocation(B,"aColor"),C=c.getUniformLocation(B,"uModelViewMatrix"),M=c.getUniformLocation(B,"uProjectionMatrix"),F=mat4.create(),D=mat4.create();if(mat4.perspective(D,Math.PI/4,d.width/d.height,.1,100),!c){console.error("WebGL not supported!");return}function N(e){document.getElementById("cameraPosition").textContent=`[${p.map(e=>e.toFixed(1)).join(", ")}]`,document.getElementById("cameraYaw").textContent=y,document.getElementById("cameraPitch").textContent=h,c.enable(c.BLEND),c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA),c.useProgram(B),c.uniformMatrix4fv(C,!1,F),c.uniformMatrix4fv(M,!1,D),c.clearColor(0,0,0,1),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),c.enable(c.DEPTH_TEST),e.length>0&&(c.bufferData(c.ARRAY_BUFFER,new Float32Array(e),c.STATIC_DRAW),c.vertexAttribPointer(I,3,c.FLOAT,!1,7*Float32Array.BYTES_PER_ELEMENT,0),c.enableVertexAttribArray(I),c.vertexAttribPointer(b,3,c.FLOAT,!1,7*Float32Array.BYTES_PER_ELEMENT,3*Float32Array.BYTES_PER_ELEMENT),c.enableVertexAttribArray(b),c.drawArrays(c.TRIANGLES,0,e.length/7))}t[0].style.top="10px",t[1].style.top="40px",t[2].style.top="70px",g(),window.draw={addtriangles:s,obj:{new_obj:r,remove_obj:o,vertices:{new_c:n,new_c_more:i}},text:{new_text:$,cam_debug},keysPressed:x,overlayText:t,roundVector:u,cam:{cameraPosition:p,cameraYaw:y,cameraPitch:h,cam_debug},Objects},e=!0});