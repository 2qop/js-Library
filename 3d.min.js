const glmatrix=document.createElement("script");glmatrix.src="https://cdn.jsdelivr.net/npm/gl-matrix@2.8.1/dist/gl-matrix-min.js",document.head.appendChild(glmatrix),glmatrix.addEventListener("load",()=>{function e(){return{pos:[0,0,0],rot:[0,0,0],vertices:[],id:""}}function t(e){e.vertices.length%21==0?Objects.push(e):console.log("add_obj not % 21")}function r(){let e=document.createElement("div");e.textContent="Styled Div",e.style.top="100px",e.classList.add("overlayText"),document.body.appendChild(e)}Objects=[],renderObjects=[];let o=[];(map_vertices=e()).id="map vertices",map_vertices.pos[1]=-1,map_vertices.vertices=[10,0,10,.34,.34,.34,1,-10,0,10,.34,.34,.34,1,-10,0,-10,.34,.34,.34,1,10,0,10,.34,.34,.34,1,10,0,-10,.34,.34,.34,1,-10,0,-10,.34,.34,.34,1],t(map_vertices);let n=[...document.querySelectorAll(".overlayText")],i=document.getElementById("3d"),a=i.getContext("webgl");function $(e){e.length%21==0&&o.push(...e)}function l(){for(let e=0;e<Objects.length;e++)for(let t=0;t<Objects[e].vertices.length/21;t++){let r=[];for(let o=0;o<21;o++)r[o]=Objects[e].vertices[21*t+o];r[0]+=Objects[e].pos[0],r[1]+=Objects[e].pos[1],r[2]+=Objects[e].pos[2],r[7]+=Objects[e].pos[0],r[8]+=Objects[e].pos[1],r[9]+=Objects[e].pos[2],r[14]+=Objects[e].pos[0],r[15]+=Objects[e].pos[1],r[16]+=Objects[e].pos[2],renderObjects.push(...r)}}function d(){A(),h(),c(i,a),renderObjects=[],l();B([...o,...renderObjects]),requestAnimationFrame(()=>d())}function c(e,t){e.width=window.innerWidth,e.height=window.innerHeight,t.viewport(0,0,e.width,e.height)}let _=[0,0,5],s=[0,0,-1],g=[0,1,0],m=-90,u=0,E={};function A(){let e=vec3.cross([],s,g);E.w&&vec3.scaleAndAdd(_,_,s,.1),E.s&&vec3.scaleAndAdd(_,_,s,-.1),E.a&&vec3.scaleAndAdd(_,_,e,-.1),E.d&&vec3.scaleAndAdd(_,_,e,.1),E.e&&(_[1]+=.1),E.q&&(_[1]-=.1),E.ArrowLeft&&(m-=1),E.ArrowRight&&(m+=1),E.ArrowUp&&(u+=1),E.ArrowDown&&(u-=1),u=Math.max(-89,Math.min(89,u)),s[0]=Math.cos(glMatrix.toRadian(m))*Math.cos(glMatrix.toRadian(u)),s[1]=Math.sin(glMatrix.toRadian(u)),s[2]=Math.sin(glMatrix.toRadian(m))*Math.cos(glMatrix.toRadian(u)),vec3.normalize(s,s)}function h(){let e=[_[0]+s[0],_[1]+s[1],_[2]+s[2]];mat4.lookAt(y,_,e,g)}document.addEventListener("keydown",e=>{E[e.key]=!0}),document.addEventListener("keyup",e=>{delete E[e.key]});let p=`
attribute vec3 aPosition;
attribute vec4 aColor;
varying vec4 vColor;
uniform mat4 uModelViewMatrix;
uniform mat4 uProjectionMatrix;
void main() {
  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(aPosition, 1.0);
  vColor = aColor;
}
`,f=`
precision mediump float;
varying vec4 vColor;
void main() {
  gl_FragColor = vColor;
}
`;function v(e,t,r){let o=e.createShader(t);return(e.shaderSource(o,r),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS))?o:(console.error("Error compiling shader:",e.getShaderInfoLog(o)),e.deleteShader(o),null)}function x(e,t,r){let o=e.createProgram();return(e.attachShader(o,t),e.attachShader(o,r),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS))?o:(console.error("Error linking program:",e.getProgramInfoLog(o)),e.deleteProgram(o),null)}let P=v(a,a.VERTEX_SHADER,p),R=v(a,a.FRAGMENT_SHADER,f),S=x(a,P,R),T=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,T);let L=a.getAttribLocation(S,"aPosition"),C=a.getAttribLocation(S,"aColor"),b=a.getUniformLocation(S,"uModelViewMatrix"),w=a.getUniformLocation(S,"uProjectionMatrix"),y=mat4.create(),M=mat4.create();if(mat4.perspective(M,Math.PI/4,i.width/i.height,.1,100),!a){console.error("WebGL not supported!");return}function B(e){document.getElementById("cameraPosition").textContent=`[${_.map(e=>e.toFixed(1)).join(", ")}]`,document.getElementById("cameraYaw").textContent=m,document.getElementById("cameraPitch").textContent=u,a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),a.useProgram(S),a.uniformMatrix4fv(b,!1,y),a.uniformMatrix4fv(w,!1,M),a.clearColor(0,0,0,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),a.enable(a.DEPTH_TEST),e.length>0&&(a.bufferData(a.ARRAY_BUFFER,new Float32Array(e),a.STATIC_DRAW),a.vertexAttribPointer(L,3,a.FLOAT,!1,7*Float32Array.BYTES_PER_ELEMENT,0),a.enableVertexAttribArray(L),a.vertexAttribPointer(C,3,a.FLOAT,!1,7*Float32Array.BYTES_PER_ELEMENT,3*Float32Array.BYTES_PER_ELEMENT),a.enableVertexAttribArray(C),a.drawArrays(a.TRIANGLES,0,e.length/7))}d(),window.draw={addtriangles:$,obj:{new_obj:e,add_obj:t},overlayText:n}});
